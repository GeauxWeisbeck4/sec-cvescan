name: cvescan
base: core18
version: '1.0.3'
summary: Security/CVE vulnerability monitoring for Ubuntu
description: |
  Bash script and XSLT file that work with OpenSCAP to provide a plain text
  list of known CVE vulnerabilities that exist for a currently supported
  Ubuntu system or for an image (using a package manifest file).

  Homepage: 
    https://github.com/canonical/sec-cvescan
  Installation:
    sudo snap install cvescan
  Basic Usage:
    cvescan
  More Usage Information:
    cvescan -h

grade: stable
confinement: strict

plugs:
  apt-dpkg-db:
    interface: system-files
    read: 
    - /var/lib/snapd/hostfs/var/lib/dpkg
    - /var/lib/snapd/hostfs/var/cache/apt
    - /etc/apt
    - /etc/dpkg

layout:
  /usr/lib/x86_64-linux-gnu/openscap:
    bind: $SNAP/usr/lib/x86_64-linux-gnu/openscap
  /usr/share/dpkg:
    bind: $SNAP/usr/share/dpkg
  /usr/share/openscap:
    bind: $SNAP/usr/share/openscap
  /usr/bin/dpkg:
    bind-file: $SNAP/usr/bin/dpkg
  /etc/dpkg/dpkg.cfg:
    bind-file: $SNAP/etc/dpkg/dpkg.cfg


apps:
  cvescan:
    command: ./cvescan
    environment:
      PATH: $PATH:$SNAP/usr/local/sbin:$SNAP/usr/local/bin:$SNAP/usr/sbin:$SNAP/usr/bin:$SNAP/sbin:$SNAP/bin:$SNAP/snap/bin
      APT_CONFIG: $SNAP/etc/apt.conf
    plugs:
    - home
    - network
    - apt-dpkg-db

parts:
  cvescan:
    plugin: dump
    source: snapcraft/

    stage-packages:
      - grep
      - dpkg
      - libopenscap8
      - debianutils
      - xsltproc
      - coreutils
      - curl
      - bzip2
